<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¸å«è¡£ - æ–‡å­—å¯¹è¯æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #000;
        }

        /* èƒŒæ™¯å›¾ */
        #background {
            position: absolute;
            width: 100%; height: 100%;
            background-image: var(--bg-src);   /* åªè´Ÿè´£å ä½ */
            background-size: cover;
            background-position: center;
            transition: background-image 0.8s ease; /* æ·¡å…¥æ·¡å‡ºæ›´é¡ºæ»‘ */
        }


        /* äººç‰©ç«‹ç»˜ */
                #character {
            position:absolute;
            bottom:50px;
            right:100px;
            width:400px;
            height:600px;
            background-size:contain;
            background-repeat:no-repeat;
            opacity:0;
            transform:translateX(50px);
            transition:all .8s ease;

            /* é»˜è®¤å…ˆç©ºç€ï¼Œè¿è¡Œæ—¶ç”¨ JS æŠŠå›¾ç‰‡åœ°å€å¡è¿›æ¥ */
            background-image:var(--role-src);
        }


        #character.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* å¯¹è¯æ¡† */
        #dialogBox {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.95));
            border-top: 3px solid #8b0000;
            padding: 30px;
            min-height: 200px;
            backdrop-filter: blur(10px);
        }

        #characterName {
            color: #ff6b6b;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        #dialogText {
            color: #fff;
            font-size: 20px;
            line-height: 1.8;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            animation: typing 2s steps(40, end);
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        /* é€‰é¡¹æŒ‰é’® */
        #choices {
            position: absolute;
            bottom: 250px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            background: rgba(139, 0, 0, 0.8);
            color: #fff;
            border: 2px solid #ff6b6b;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            min-width: 300px;
            text-align: center;
        }

        .choice-btn:hover {
            background: rgba(255, 107, 107, 0.9);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.5);
        }

        /* éŸ³æ•ˆæŒ‰é’® */
        #soundToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            border: 2px solid #fff;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }

        /* å¼€å§‹ç•Œé¢ */
        #startScreen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #gameTitle {
            font-size: 72px;
            color: #8b0000;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 50px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 20px rgba(139, 0, 0, 0.5); }
            50% { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 40px rgba(255, 107, 107, 0.8); }
        }

        #startBtn {
            background: linear-gradient(45deg, #8b0000, #ff6b6b);
            color: #fff;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        #startBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5);
        }

        /* ç‚¹å‡»ç»§ç»­æç¤º */
        #clickHint {
            position: absolute;
            bottom: 20px;
            right: 30px;
            color: #ff6b6b;
            font-size: 16px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="background"></div>
        <div id="character"></div>
        
        <div id="dialogBox">
            <div id="characterName"></div>
            <div id="dialogText"></div>
            <div id="clickHint">ç‚¹å‡»ç»§ç»­...</div>
        </div>
        
        <div id="choices"></div>
        
        <button id="soundToggle">ğŸ”Š éŸ³æ•ˆ</button>
        
        <div id="startScreen">
            <h1 id="gameTitle">çº¸å«è¡£</h1>
            <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            currentScene: 0,
            scenes: [
                {
                    character: "æ—ç™½",
                    text: "åœ¨ä¸€ä¸ªåè¿œçš„å°å±±æ‘é‡Œï¼Œæµä¼ ç€ä¸€ä¸ªå…³äºçº¸å«è¡£çš„ä¼ è¯´...",
                    background: "å±±æ‘èƒŒæ™¯.jpg",
                    showCharacter: false
                },
                {
                    character: "ç±³æ‰",
                    text: "æˆ‘æ˜¯æ‘é‡Œæ–°æ¥çš„è®°è€…ï¼Œå¬è¯´è¿™é‡Œæœ€è¿‘å‘ç”Ÿäº†ä¸€äº›æ€ªäº‹ï¼Ÿ",
                    background: "village",
                    showCharacter: true,
                    role:"mi.png",
                    background: "å±±æ‘èƒŒæ™¯.jpg"
                },
                {
                    character: "ç‘æµ·",
                    text: "å¹´è½»äººï¼Œæœ‰äº›äº‹æƒ…ä¸è¯¥é—®çš„å°±ä¸è¦é—®ã€‚ç‰¹åˆ«æ˜¯å…³äºçº¸å«è¡£çš„äº‹...",
                    background: "village",
                    showCharacter: true,
                    role:"rui.jpg",
                    background: "å±±æ‘èƒŒæ™¯.jpg"
                },
                {
                    character: "ç±³æ‰",
                    text: "çº¸å«è¡£ï¼Ÿé‚£æ˜¯ä»€ä¹ˆï¼Ÿ",
                    background: "village",
                    showCharacter: true,
                    choices: [
                        { text: "ç»§ç»­è¿½é—®", nextScene: 4 },
                        { text: "æš‚æ—¶æ”¾å¼ƒ", nextScene: 5 }
                    ],
                    role:"mi.png",
                    background: "å±±æ‘èƒŒæ™¯.jpg"

                },
                {
                    character: "ç•…å§",
                    text: "å”‰...é‚£æ˜¯æˆ‘ä»¬æ‘å­çš„è¯…å’’ã€‚æ¯å½“æœ‰äººç©¿ä¸Šçº¸åšçš„å«è¡£ï¼Œå°±ä¼šåœ¨ä¸ƒå¤©å...",
                    background: "dark",
                    showCharacter: true,
                    role:"SU.png",
                    background: "å±±æ‘èƒŒæ™¯.jpg"
                },
                {
                    character: "ç•…å§",
                    text: "ç®—äº†ï¼Œä½ å›å»å§ã€‚å¤©è‰²ä¸æ—©äº†ï¼Œæ™šä¸Šä¸è¦å‡ºé—¨ã€‚",
                    background: "village",
                    showCharacter: true,
                    role:"SU.png",
                    background: "å±±æ‘èƒŒæ™¯.jpg",
                },
                {
                    character: "ç±³æ‰",
                    text: "æ™šä¸Šï¼Œæˆ‘èººåœ¨åºŠä¸Šï¼Œæ€»æ˜¯æƒ³ç€çº¸å«è¡£çš„äº‹ã€‚çªç„¶ï¼Œæˆ‘å¬åˆ°äº†ä¸€é˜µå”¢å‘å£°...",
                    background: "night",
                    showCharacter: true,
                    role:"mi.png"
                },
                {
                    character: "ç¥ç§˜å£°éŸ³",
                    text: "å‘œå‘œå‘œ...è¿˜æˆ‘å«è¡£...è¿˜æˆ‘å‘½æ¥...",
                    background: "dark",
                    showCharacter: false
                },
                {character: "ç±³æ‰",
                    text: "ä»–å¦ˆä»€ä¹ˆé˜´é—´ï¼Œç»™æˆ‘å°¿å“å‡ºæ¥ä¸¤æ»´",
                    background: "night",
                    showCharacter: true,
                    role:"mi.png"
                }
            ]
        };

        let isTyping = false;
        let soundEnabled = true;

        // éŸ³æ•ˆæ¨¡æ‹Ÿ
        function playSound(type) {
            if (!soundEnabled) return;
            
            // è¿™é‡Œä½¿ç”¨ Web Audio API åˆ›å»ºç®€å•çš„éŸ³æ•ˆ
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
                case 'horror':
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.2;
                    oscillator.type = 'sawtooth';
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
            }
        }

        // æ˜¾ç¤ºå¯¹è¯
        function showDialog(scene) {
            const sceneData = gameData.scenes[scene];
            const nameEl = document.getElementById('characterName');
            const textEl = document.getElementById('dialogText');
            const characterEl = document.getElementById('character');
            const choicesEl = document.getElementById('choices');
            
            nameEl.textContent = sceneData.character;
            
            // æ‰“å­—æœºæ•ˆæœ
            textEl.textContent = '';
            isTyping = true;
            let i = 0;
            const typing = setInterval(() => {
                if (i < sceneData.text.length) {
                    textEl.textContent += sceneData.text.charAt(i);
                    i++;
                } else {
                    clearInterval(typing);
                    isTyping = false;
                    
                    // æ˜¾ç¤ºé€‰é¡¹
                    if (sceneData.choices) {
                        setTimeout(() => {
                            choicesEl.innerHTML = '';
                            choicesEl.style.display = 'flex';
                            sceneData.choices.forEach(choice => {
                                const btn = document.createElement('button');
                                btn.className = 'choice-btn';
                                btn.textContent = choice.text;
                                btn.onclick = () => {
                                    playSound('click');
                                    choicesEl.style.display = 'none';
                                    gameData.currentScene = choice.nextScene;
                                    showDialog(choice.nextScene);
                                };
                                choicesEl.appendChild(btn);
                            });
                        }, 500);
                    }
                }
            }, 50);
            
            // æ˜¾ç¤º/éšè—è§’è‰²
            if (sceneData.showCharacter) {
                // ä¸´æ—¶å†™æ­»
                // åŸæ¥å†™æ­»ï¼šcharEl.style.backgroundImage = 'url(...)';

                // æ”¹å›å˜é‡ï¼š
                const imgUrl = `img/${sceneData.role}`;
                characterEl.style.setProperty('--role-src', `url(${imgUrl})`);


                characterEl.classList.add('show');
            } else {
                characterEl.classList.remove('show');
            }
            // èƒŒæ™¯åˆ‡æ¢
            const bgUrl = `img/${sceneData.background}`;   // æ‹¼å‡º img/village.jpg
            document.getElementById('background')
                    .style.setProperty('--bg-src', `url(${bgUrl})`);

            
            // æ”¹å˜èƒŒæ™¯
            updateBackground(sceneData.background);

        }

        // æ›´æ–°èƒŒæ™¯
        function updateBackground(type) {
            const bg = document.getElementById('background');
            switch(type) {
                case 'dark':
                    bg.style.filter = 'brightness(0.3) contrast(1.5)';
                    break;
                case 'night':
                    bg.style.filter = 'brightness(0.2) contrast(1.8) hue-rotate(240deg)';
                    break;
                default:
                    bg.style.filter = 'brightness(0.7) contrast(1.2)';
            }
        }

        // å¼€å§‹æ¸¸æˆ
        document.getElementById('startBtn').addEventListener('click', () => {
            playSound('click');
            document.getElementById('startScreen').style.display = 'none';
            showDialog(0);
        });

        // ç‚¹å‡»ç»§ç»­
        document.getElementById('gameContainer').addEventListener('click', (e) => {
            if (e.target.id === 'gameContainer' || e.target.id === 'dialogBox' || e.target.id === 'dialogText') {
                if (!isTyping && !document.getElementById('choices').style.display.includes('flex')) {
                    playSound('click');
                    if (gameData.currentScene < gameData.scenes.length - 1) {
                        gameData.currentScene++;
                        showDialog(gameData.currentScene);
                    }
                }
            }
        });

        // éŸ³æ•ˆå¼€å…³
        document.getElementById('soundToggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            this.textContent = soundEnabled ? 'ğŸ”Š éŸ³æ•ˆ' : 'ğŸ”‡ éŸ³æ•ˆ';
            playSound('click');
        });

        // æ·»åŠ ææ€–éŸ³æ•ˆï¼ˆéšæœºï¼‰
        setInterval(() => {
            if (Math.random() < 0.1 && soundEnabled) {
                playSound('horror');
            }
        }, 10000);
    </script>
</body>
</html>

